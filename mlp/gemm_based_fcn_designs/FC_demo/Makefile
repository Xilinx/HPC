INCLUDES=-I.
SRCS=QRes_mkl_bench.cpp
TARGET=./QRes_mkl_bench3.exe

DATA_PATH=./data/
BATCH_SIZE=204800
NUM_THREADS=96
DUMP_RESULT=1
SIGMOID=1

CFLAGS=-O3 -std=c++11 \
	   -DSIGMOID=${SIGMOID} \
	   -DDUMP_RESULT=${DUMP_RESULT}  -DMKL_ILP64 -m64 -I${MKLROOT}/include  -L${MKLROOT}/lib/intel64 -Wl,--no-as-needed -lmkl_intel_ilp64 -lmkl_gnu_thread -lmkl_core -lgomp -lpthread -lm -ldl
	   
CXX=g++

help:
	@echo " USAGE: make run DATA_PATH=./data/ BATCH_SIZE=2048 NUM_THREAD=32 "

${TARGET}: ${SRCS}
	${CXX} $^ -o $@ ${INCLUDES} ${CFLAGS} 

run: ${TARGET}
	${TARGET} ${DATA_PATH} ${BATCH_SIZE} ${NUM_THREADS}

benchmark:
	make clean 
	make ${TARGET} DUMP_RESULT=0
	${TARGET} ${DATA_PATH} 204800 ${NUM_THREADS}
	${TARGET} ${DATA_PATH} 307200 ${NUM_THREADS}
	${TARGET} ${DATA_PATH} 409600 ${NUM_THREADS}
	${TARGET} ${DATA_PATH} 512000 ${NUM_THREADS}
	${TARGET} ${DATA_PATH} 614400 ${NUM_THREADS}
	${TARGET} ${DATA_PATH} 716800 ${NUM_THREADS}
	${TARGET} ${DATA_PATH} 819200 ${NUM_THREADS}
	${TARGET} ${DATA_PATH} 921600 ${NUM_THREADS}
	${TARGET} ${DATA_PATH} 1024000 ${NUM_THREADS}
	${TARGET} ${DATA_PATH} 1126400 ${NUM_THREADS}
	${TARGET} ${DATA_PATH} 1228800 ${NUM_THREADS}
	${TARGET} ${DATA_PATH} 1331200 ${NUM_THREADS}
	${TARGET} ${DATA_PATH} 1433600 ${NUM_THREADS}
	${TARGET} ${DATA_PATH} 1536000 ${NUM_THREADS}
	${TARGET} ${DATA_PATH} 1638400 ${NUM_THREADS}
	${TARGET} ${DATA_PATH} 1740800 ${NUM_THREADS}
clean:
	rm -rf ${TARGET}
	rm -rf ${DATA_PATH}/mat*
